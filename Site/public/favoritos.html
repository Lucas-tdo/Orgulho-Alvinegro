<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Favoritos</title>
    <link rel="stylesheet" href="style/stylefavoritos.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container">
        <nav>
            <div class="menu">     
                    <div href="" class="secao">
                        <a href="perfil.html">

                            <img src="image/icon/perfil_conta.png" alt="">
                            <h2>Perfil</h2>
                        </a>
                    </div>

                    <div class="secao atual">
                        <a href="favoritos.html">
                            <img src="image/icon/favoritos_conta.png" alt="">
                            <h2>Favoritos</h2>
                        </a>
                    </div>
                
                    <div class="secao">
                        <a href="index.html">
                            <img src="image/icon/voltar.png" alt="">
                        </a>
                    </div>      
            </div>
        </nav>
        <div class="dash">
            <div class="kpi">
                <div class="card_kpi">
                    <h1 id="quantidade"></h1>
                    <h2>Camisas Favoritadas</h3>
                </div>
                <div class="card_kpi">
                    <div class="imagem">
                        <img src="image/camisas/camisa2024-2.png" alt="">
                    </div>
                    <div class="titulo">
                        <h3>Ultima Favoritada</h3>
                        <h4>2º Camisa Reebook 2024</h4>
                    </div>
                </div>
            </div>
            <div class="graficos">
                <div class="grafico">
                    <h1>Ano mais favoritado do Usuário:</h1>
                    <canvas id="myChart2" style="position: relative; height:40vh; width:40vw"></canvas>
                </div>
                <div class="grafico">
                    <h1>Marca mais favoritada do Usuário:</h1>
                    <canvas id="myChart" style="position: relative; height:40vh; width:40vw"></canvas>
                    
                </div>
            </div>
            <div class="lista">
                <div class="listagem">
                    <div class="titulo_lista">
                        <h1>Listagem:</h1>
                        <h3 id="valortotal">Valor Total: <br>R$</h3>
                    </div>
                    <div class="camisas" id="camisas">
                        
                        
                        
                    </div>
                    
                </div>
                
            </div>
        </div>
    </div>
    
</body>
</html>
<script>
  
    var idusuario = sessionStorage.getItem("ID_USUARIO")
    qtd_camisas()
    listar()
    anofavoritado()
    marcafavoritada()
     const ctx2 = document.getElementById('myChart2');
     const ctx = document.getElementById('myChart');

const ano = new Chart(ctx2, {
  type: 'bar',
  data: {
    labels: ['Anos'],
    datasets: []
  },
  options: {
    scales: {
      y: {
    suggestedMin: 0,
    suggestedMax: 10,
      }
    }
    
  }
});

const marca = new Chart(ctx, {
  type: 'bar',
  data: {
    labels: ['Marcas'],
    datasets: []
  },
  options: {
    scales: {
      y: {
    suggestedMin: 0,
    suggestedMax: 10,
      }
    }
    
  }
});

function qtd_camisas(){
  fetch(`favorita/qtd_camisas/${idusuario}`,{
    method:"GET",
    headers :{
      "Content-Type": "application/json",
    },
  })
  .then(resposta=>{resposta.json().then(resposta=>{
        quantidade.innerHTML=`${resposta[0].quantidade}`
      })
    })
  .catch(erro=>{
      console.log(erro)
  })
}

function listar(){
  fetch(`favorita/listar/${idusuario}`,{
    method:"GET",
    headers:{
      "Content-Type": "application/json",
    }
  })
  .then(resposta=>{resposta.json().then(resposta=>{
      camisas.innerHTML=``
      var precot=0
      var texto=''
      for(resp of resposta){
        texto+=`<div class="card">
                            <img src="${resp.imagem}" alt="">
                            
                            <h5>${resp.nome} ${resp.marca} ${resp.ano} </h5>
                            <h5>R$${resp.preco}</h5>
                        </div>`
                        precot+=Number(resp.preco)
      }
      valortotal.innerHTML+=precot.toFixed(2)  
      camisas.innerHTML=texto
    })
    
  })
  .catch(erro=>{
    console.log(erro)
  })
}

function anofavoritado(){
  fetch(`favorita/anofavoritado/${idusuario}`,{
    method:"GET",
    headers:{
      "Content-Type": "application/json",
    }
  })
  .then(resposta=>{resposta.json().then(resposta=>{
      var contandor = 0
      for(resp of resposta){
        var novo = {
        label: `${resp.ano}`,
        backgroundColor:'rgb(43, 41, 41)',
        borderColor:'rgb(0, 0, 0)',
        data: [`${resp.quantidade}`],
        borderWidth: 1
      }
        ano.data.datasets.push(novo)
      }
      ano.update()
    })
  })
  .catch(erro=>{
    console.log(erro)
  })
}

function marcafavoritada(){
  fetch(`favorita/marcafavoritada/${idusuario}`,{
    method:"GET",
    headers:{
      "Content-Type": "application/json",
    }
  })
  .then(resposta=>{resposta.json().then(resposta=>{
      for(resp of resposta){
        var novo = {
           label: `${resp.marca}`,
            backgroundColor:'rgb(128, 128, 128)',
            borderColor:'rgb(0,0,0)',
            data: [`${resp.quantidade}`],
            borderWidth: 1
        }
        marca.data.datasets.push(novo)
      }
      marca.update()
    })
  })
  .catch(erro=>{
    console.log(erro)
  })
}
</script>